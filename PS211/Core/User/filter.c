#include "filter.h"

const uint8_t filter_weight[WIN_SIZE] = {10, 15, 20, 25, 30, 40, 50, 60, 70, 80};

/**
  * @brief  ????????????????? (??????uint16_t???????ADC???)
  * @param  array: ?????????????????????
  * @param  new_value: ????????????
  * @retval ???????? (uint16_t)
  */
uint16_t SlidingFilter(uint16_t array[WIN_SIZE], uint16_t new_value)
{
    // ??????????????????????????????
    for(int i = 0; i < WIN_SIZE - 1; i++) {
        array[i] = array[i + 1];
    }
    array[WIN_SIZE - 1] = new_value; // ???????????????? new_value

    // ??????????32¦Ë??????????
    uint32_t sum = 0;        // ???32¦Ë???????????
    uint16_t weight_sum = 0; // ??????????????????????????

    for(uint8_t i = 0; i < WIN_SIZE; i++) {
        // ???? filter_weight ? uint16_t ??????????????????
        sum += (uint32_t)filter_weight[i] * (uint32_t)array[i];
        weight_sum += filter_weight[i];
    }

    // ??????????????????????
    uint16_t result = 0;
    if(weight_sum != 0) {
        // ?????????????????????????
        result = (uint16_t)((sum + (weight_sum / 2)) / weight_sum);
    }
    // ??? weight_sum ? 0?????? 0 ?????????????????????
    return result;
}

